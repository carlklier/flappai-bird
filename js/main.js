var currentstate,debugmode=!1,states=Object.freeze({SplashScreen:0,GameScreen:1,ScoreScreen:2,SaveDataScreen:3}),collisionPosition=10,gravity=.25,velocity=0,position=180,rotation=0,jump=-4.6,flyArea=$("#flyarea").height(),score=0,highscore=0,startTime=0,duration=0,savedata={},ddaEnabled=!1,pipeHeightMin=75,pipeheight=90,pipeHeightMax=130,pipewidth=52,pipeIntervalMin=1100,pipeInterval=1400,pipeIntervalMax=1800,pipes=new Array,pipeRate=Math.round(60*pipeInterval/1e3),pipeRateCount=0;gravityMultiplier=1,pipeHeightMultiplier=1,pipeIntervalMultiplier=1;var loopGameloop,loopPipeloop,previousState,replayclickable=!1,volume=30,soundJump=new buzz.sound("assets/sounds/sfx_wing.ogg"),soundScore=new buzz.sound("assets/sounds/sfx_point.ogg"),soundHit=new buzz.sound("assets/sounds/sfx_hit.ogg"),soundDie=new buzz.sound("assets/sounds/sfx_die.ogg"),soundSwoosh=new buzz.sound("assets/sounds/sfx_swooshing.ogg");function showSplash(){currentstate=states.SplashScreen,velocity=0,position=180,rotation=0,score=0,$("#player").css({y:0,x:0}),updatePlayer($("#player")),soundSwoosh.stop(),soundSwoosh.play(),$(".pipe").remove(),pipes=new Array,$(".animated").css("animation-play-state","running"),$(".animated").css("-webkit-animation-play-state","running"),$("#splash").transition({opacity:1},2e3,"ease")}function startGame(){currentstate=states.GameScreen,$("#splash").stop(),$("#splash").transition({opacity:0},500,"ease"),setBigScore(),debugmode&&($(".boundingbox").show(),$(".botPipeBox").show(),$(".topPipeBox").show()),loopGameloop=setInterval(gameloop,1e3/60),startTime=Date.now(),playerJump()}function updatePlayer(e){rotation=Math.min(velocity/10*90,90),$(e).css({rotate:rotation,top:position})}function gameloop(){0==(pipeRateCount%=pipeRate)&&(score>10&&score%5==0&&(modifyPipeInterval("decrease"),modifyPipeHeight("decrease")),updatePipes(),pipeRateCount=0),pipeRateCount+=1;var e=$("#player");position+=velocity+=gravity,updatePlayer(e);var o=document.getElementById("player").getBoundingClientRect(),i=34-8*Math.sin(Math.abs(rotation)/90),t=(24+o.height)/2,a=(o.width-i)/2+o.left,n=(o.height-t)/2+o.top,s=a+i,p=n+t;if(debugmode&&((r=$("#playerbox")).css("left",a),r.css("top",n),r.css("height",t),r.css("width",i)),o.bottom>=$("#land").offset().top)return collisionPosition=10,playerDead(),debugmode&&(console.log("hit ground"),console.log("collisionPosition: "+collisionPosition)),void setCookie("collisionPosition",collisionPosition,999);var l=$("#ceiling");if(n<=l.offset().top+l.height()&&(position=0),null!=pipes[0]){var r,c=pipes[0],d=c.children(".pipe_upper"),u=(c.children(".pipe_lower"),d.offset().top+d.height()),g=d.offset().left-2,h=g+pipewidth,v=u+pipeheight;if(debugmode&&((r=$("#pipebox")).css("left",g),r.css("top",u),r.css("height",pipeheight),r.css("width",pipewidth)),s>g&&!(n>u&&p<v))return n<u?(collisionPosition=11,playerDead(),debugmode&&(console.log("Collision with upper pipe"),console.log("collisionPosition: "+collisionPosition)),void setCookie("collisionPosition",collisionPosition,999)):n<v?(collisionPosition=12,playerDead(),debugmode&&(console.log("Collision with lower pipe"),console.log("collisionPosition: "+collisionPosition)),void setCookie("collisionPosition",collisionPosition,999)):(collisionPosition=13,playerDead(),debugmode&&(console.log("hit pipe, catch all"),console.log("collisionPosition: "+collisionPosition)),void setCookie("collisionPosition",collisionPosition,999));a>h&&(pipes.splice(0,1),playerScore())}}function screenClick(){currentstate==states.GameScreen?playerJump():currentstate==states.SplashScreen&&startGame()}function modifyGravity(e){ddaEnabled&&(33==e||"increase"==e?(gravityMultiplier+=.01,gravity*=gravityMultiplier,debugmode&&console.log("gravity increased to: "+gravity)):(gravityMultiplier-=.01,gravity*=gravityMultiplier,debugmode&&console.log("gravity decreased to: "+gravity)))}function modifyPipeInterval(e){ddaEnabled&&(188==e||"decrease"==e?(pipeIntervalMultiplier-=.01,(pipeInterval*=pipeIntervalMultiplier)>pipeIntervalMax?pipeInterval=pipeIntervalMax:pipeInterval<pipeIntervalMin&&(pipeInterval=pipeIntervalMin),pipeRate=Math.round(60*pipeInterval/1e3),debugmode&&(console.log("pipeInterval decreased to: "+pipeInterval),console.log("pipeRate decreased to "+pipeRate))):(pipeIntervalMultiplier+=.0075,(pipeInterval*=pipeIntervalMultiplier)>pipeIntervalMax?pipeInterval=pipeIntervalMax:pipeInterval<pipeIntervalMin&&(pipeInterval=pipeIntervalMin),pipeRate=Math.round(60*pipeInterval/1e3),debugmode&&(console.log("pipeInterval increased to: "+pipeInterval),console.log("pipeRate increased to "+pipeRate))))}function modifyPipeHeight(e){ddaEnabled&&(219==e||"decrease"==e?(pipeHeightMultiplier-=.013,(pipeheight*=pipeHeightMultiplier)>pipeHeightMax?pipeheight=pipeHeightMax:pipeheight<pipeHeightMin&&(pipeheight=pipeHeightMin),debugmode&&console.log("pipeheight decreased to: "+pipeheight)):(pipeHeightMultiplier+=.01,(pipeheight*=pipeHeightMultiplier)>pipeHeightMax?pipeheight=pipeHeightMax:pipeheight<pipeHeightMin&&(pipeheight=pipeHeightMin),debugmode&&console.log("pipeheight increased to: "+pipeheight)))}function playerJump(){velocity=jump,soundJump.stop(),soundJump.play()}function setBigScore(e){var o=$("#bigscore");if(o.empty(),!e)for(var i=score.toString().split(""),t=0;t<i.length;t++)o.append("<img src='assets/font_big_"+i[t]+".png' alt='"+i[t]+"'>")}function setSmallScore(){var e=$("#currentscore");e.empty();for(var o=score.toString().split(""),i=0;i<o.length;i++)e.append("<img src='assets/font_small_"+o[i]+".png' alt='"+o[i]+"'>")}function setHighScore(){var e=$("#highscore");e.empty();for(var o=highscore.toString().split(""),i=0;i<o.length;i++)e.append("<img src='assets/font_small_"+o[i]+".png' alt='"+o[i]+"'>")}function setMedal(){var e=$("#medal");return e.empty(),!(score<10||(score>=10&&(medal="bronze"),score>=20&&(medal="silver"),score>=30&&(medal="gold"),score>=40&&(medal="platinum"),e.append('<img src="assets/medal_'+medal+'.png" alt="'+medal+'">'),0))}function playerDead(){duration=Date.now()-startTime,$(".animated").css("animation-play-state","paused"),$(".animated").css("-webkit-animation-play-state","paused"),ddaEnabled&&score<10&&(debugmode&&console.log("score: "+score),modifyPipeHeight("increase"),modifyPipeInterval("increase")),ddaEnabled&&score>30&&(debugmode&&console.log("score: "+score),debugmode&&console.log("Multilpiers reset to 1"),pipeHeightMultiplier=1,pipeIntervalMultiplier=1);var e=$("#player").position().top+$("#player").width(),o=flyArea,i=Math.max(0,o-e);$("#player").transition({y:i+"px",rotate:90},1e3,"easeInOutCubic"),currentstate=states.ScoreScreen,clearInterval(loopGameloop),clearInterval(loopPipeloop),loopGameloop=null,loopPipeloop=null,isIncompatible.any()?showScore():soundHit.play().bindOnce("ended",(function(){soundDie.play().bindOnce("ended",(function(){showScore()}))}))}function downloadSaveData(){currentstate!=states.GameScreen&&download("save.txt",getCookie("savedata"))}function clearSaveData(){savedata={},highscore=0,clearAllCookies(),ddaEnabled=!1,gravity=.25,pipeInterval=1400,pipeheight=90,savedata.data=[],savedata.ddaEnabled=ddaEnabled}function showScore(){$("#scoreboard").css("display","block"),setBigScore(!0),score>highscore&&(highscore=score,setCookie("highscore",highscore,999)),setSmallScore(),setHighScore();var e=setMedal(),o={startTime,duration,score,gravity,pipeInterval,pipeheight,collisionPosition};savedata.data.push(o),debugmode&&console.log(savedata),setObject("savedata",savedata,999),soundSwoosh.stop(),soundSwoosh.play(),$("#scoreboard").css({y:"40px",opacity:0}),$("#replay").css({y:"40px",opacity:0}),$("#scoreboard").transition({y:"0px",opacity:1},600,"ease",(function(){soundSwoosh.stop(),soundSwoosh.play(),$("#replay").transition({y:"0px",opacity:1},600,"ease"),e&&($("#medal").css({scale:2,opacity:0}),$("#medal").transition({opacity:1,scale:1},1200,"ease"))})),replayclickable=!0}function playerScore(){score+=1,soundScore.stop(),soundScore.play(),setBigScore()}function updatePipes(){$(".pipe").filter((function(){return $(this).position().left<=-100})).remove();var e=flyArea-pipeheight-160,o=Math.floor(Math.random()*e+80),i=$('<div class="pipe animated"><div class="pipe_upper" style="height: '+o+'px;"></div><div class="pipe_lower" style="height: '+(flyArea-pipeheight-o)+'px;"></div></div>');$("#flyarea").append(i),pipes.push(i)}buzz.all().setVolume(volume),$(document).ready((function(){"?debug"==window.location.search&&(debugmode=!0),"?easy"==window.location.search&&(pipeheight=200);var e=getCookie("highscore");""!=e&&(highscore=parseInt(e));var o=getCookie("ddaEnabled");""!=o?ddaEnabled="true"===o:(ddaEnabled="?a"==window.location.search||"?b"!=window.location.search&&Math.random()<.5,setCookie("ddaEnabled",ddaEnabled,999)),(savedata=getObject("savedata")).ddaEnabled=ddaEnabled,Array.isArray(savedata.data)||(savedata.data=[]),debugmode&&console.log(savedata),setObject("savedata",savedata,999);var i=getCookie("collisionPosition");""!=i&&(collisionPosition=parseInt(i)),showSplash()})),$(document).keydown((function(e){32==e.keyCode&&(currentstate==states.ScoreScreen?$("#replay").click():screenClick()),219!=e.keyCode&&221!=e.keyCode||modifyPipeHeight(e.keyCode),33!=e.keyCode&&34!=e.keyCode||modifyGravity(e.keyCode),188!=e.keyCode&&190!=e.keyCode||modifyPipeInterval(e.keyCode),"q"!==e.key||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||clearSaveData()})),"ontouchstart"in window?($(document).on("touchstart",screenClick),$("#savedata").on("touchstart",(function(e){e.preventDefault(),e.stopPropagation(),downloadSaveData()}))):($(document).on("mousedown",screenClick),$("#savedata").mousedown((function(e){e.preventDefault(),e.stopPropagation(),downloadSaveData()}))),$("#replay").click((function(){replayclickable&&(replayclickable=!1,soundSwoosh.stop(),soundSwoosh.play(),$("#scoreboard").transition({y:"-40px",opacity:0},1e3,"ease",(function(){$("#scoreboard").css("display","none"),showSplash()})))}));var isIncompatible={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Safari:function(){return navigator.userAgent.match(/OS X.*Safari/)&&!navigator.userAgent.match(/Chrome/)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isIncompatible.Android()||isIncompatible.BlackBerry()||isIncompatible.iOS()||isIncompatible.Opera()||isIncompatible.Safari()||isIncompatible.Windows()}};